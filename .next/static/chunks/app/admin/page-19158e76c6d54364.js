(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[698],{565:(e,a,t)=>{Promise.resolve().then(t.bind(t,7220))},5695:(e,a,t)=>{"use strict";var s=t(8999);t.o(s,"useParams")&&t.d(a,{useParams:function(){return s.useParams}}),t.o(s,"useRouter")&&t.d(a,{useRouter:function(){return s.useRouter}})},6104:(e,a,t)=>{"use strict";t.d(a,{CS:()=>u,Gq:()=>o,HS:()=>h,J_:()=>m,Mv:()=>b,Vb:()=>N,YX:()=>x,ab:()=>p,db:()=>d,fC:()=>v,iJ:()=>c,j2:()=>i,qY:()=>f});var s=t(3915),l=t(5317),r=t(6203);let n=(0,s.Wp)({apiKey:"AIzaSyBreQy9u91K6FMTcoY4rl22zNAw_f0juAo",authDomain:"novelplane.firebaseapp.com",projectId:"novelplane",storageBucket:"novelplane.firebasestorage.app",messagingSenderId:"208383799577",appId:"1:208383799577:web:ca27cea78d7588d73e9588"}),d=(0,l.aU)(n),i=(0,r.getAuth)(n);async function c(e,a,t,s){let r=(0,l.H9)(d,"users/".concat(e,"/history"),"".concat(a,"_").concat(t));await (0,l.BN)(r,{novelId:a,chapterId:t,title:s,readAt:(0,l.O5)()})}let o=async(e,a,t)=>{let s=(0,l.H9)(d,"users/".concat(e,"/lastRead"),a);await (0,l.BN)(s,{chapterId:t})},u=async(e,a)=>{let t=(0,l.H9)(d,"users/".concat(e,"/lastRead"),a),s=await (0,l.x7)(t);return s.exists()&&s.data().chapterId||null},p=async()=>(await (0,l.GG)((0,l.rJ)(d,"novels"))).docs.map(e=>({id:e.id,...e.data()})),m=async e=>{let a=(await (0,l.GG)((0,l.rJ)(d,"bookmarks"))).docs.map(e=>({id:e.id,...e.data()})).filter(a=>a.userId===e&&a.novelId).map(e=>e.novelId);return 0===a.length?[]:(await (0,l.GG)((0,l.rJ)(d,"novels"))).docs.map(e=>({id:e.id,...e.data()})).filter(e=>a.includes(e.id))},h=async()=>{let e=await (0,l.GG)((0,l.rJ)(d,"novels")),a=new Set;return e.docs.forEach(e=>{let t=e.data();Array.isArray(t.tags)&&t.tags.forEach(e=>a.add(e))}),Array.from(a)},b=async e=>(await (0,l.GG)((0,l.rJ)(d,"novels"))).docs.map(e=>({id:e.id,...e.data()})).filter(a=>Array.isArray(a.tags)&&a.tags.includes(e)),v=async e=>{(0,l.H9)(d,"novels",e);let a=await (0,l.GG)((0,l.rJ)(d,"novels")),t=null;if(a.forEach(a=>{a.id===e&&(t={id:a.id,...a.data()})}),!t)return null;let s=(await (0,l.GG)((0,l.rJ)(d,"novels",e,"chapters"))).docs.map(e=>({id:e.id,...e.data()}));return{...t,chapters:s}},x=async(e,a)=>{(0,l.H9)(d,"novels",e,"chapters",a);let t=await (0,l.GG)((0,l.rJ)(d,"novels",e,"chapters")),s=null;return t.forEach(e=>{e.id===a&&(s={id:e.id,...e.data()})}),s},N=async e=>{let a=(0,l.rJ)(d,"novels",e,"chapters");return(await (0,l.GG)(a)).docs.map(e=>({id:e.id,...e.data()}))},f=async e=>(await (0,l.GG)((0,l.rJ)(d,"users/".concat(e,"/history")))).docs.map(e=>({id:e.id,...e.data()}))},7220:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>c});var s=t(5155),l=t(2115),r=t(5317),n=t(6104),d=t(6203),i=t(5695);function c(){let e=(0,i.useRouter)(),[a,t]=(0,l.useState)(null),[c,o]=(0,l.useState)(""),[u,p]=(0,l.useState)([]),[m,h]=(0,l.useState)([]),[b,v]=(0,l.useState)(""),[x,N]=(0,l.useState)(""),[f,y]=(0,l.useState)(""),[w,g]=(0,l.useState)(""),[j,G]=(0,l.useState)(null),[C,S]=(0,l.useState)(null);(0,l.useEffect)(()=>{let a=(0,d.onAuthStateChanged)(n.j2,a=>{(null==a?void 0:a.email)==="ramsai0014@gmail.com"?(t(a),A()):e.push("/login")});return()=>a()},[]);let A=async()=>{p((await (0,r.GG)((0,r.rJ)(n.db,"novels"))).docs.map(e=>({id:e.id,...e.data()})))},J=async e=>{let a=(0,r.rJ)(n.db,"novels",e,"chapters");h((await (0,r.GG)(a)).docs.map(e=>({id:e.id,...e.data()})))},k=async e=>{e.preventDefault(),c&&(await (0,r.gS)((0,r.rJ)(n.db,"novels"),{title:c,createdAt:Date.now()}),o(""),A())},E=async e=>{if(e.preventDefault(),!x||!f||!b)return;let a={title:x,content:f,chapterNumber:parseInt(w),updatedAt:Date.now()};j?(await (0,r.mZ)((0,r.H9)(n.db,"novels",b,"chapters",j),a),G(null),S(null)):await (0,r.gS)((0,r.rJ)(n.db,"novels",b,"chapters"),{...a,createdAt:Date.now()}),N(""),y(""),g(""),J(b)},I=async e=>{await (0,r.kd)((0,r.H9)(n.db,"novels",b,"chapters",e)),J(b)};return(0,s.jsxs)("div",{className:"p-4",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold mb-4",children:"Admin Panel"}),(0,s.jsxs)("form",{onSubmit:k,className:"mb-6",children:[(0,s.jsx)("input",{value:c,onChange:e=>o(e.target.value),placeholder:"Novel Title",className:"border p-2 mr-2"}),(0,s.jsx)("button",{className:"bg-blue-500 text-white px-4 py-2",children:"Add Novel"})]}),(0,s.jsx)("h2",{className:"text-xl font-semibold",children:"Novels"}),(0,s.jsx)("ul",{className:"mb-6",children:u.map(e=>(0,s.jsx)("li",{onClick:()=>{v(e.id),J(e.id)},className:"cursor-pointer text-blue-600 underline",children:e.title},e.id))}),b&&(0,s.jsxs)("form",{onSubmit:E,className:"mb-6",children:[(0,s.jsx)("input",{value:x,onChange:e=>N(e.target.value),placeholder:"Chapter Title",className:"border p-2 mr-2"}),(0,s.jsx)("input",{value:w,onChange:e=>g(e.target.value),placeholder:"Chapter Number",className:"border p-2 mr-2",type:"number"}),(0,s.jsx)("textarea",{value:f,onChange:e=>y(e.target.value),placeholder:"Chapter Content",className:"border p-2 mr-2"}),(0,s.jsx)("button",{className:"bg-green-600 text-white px-4 py-2",children:j?"Update Chapter":"Add Chapter"}),j&&(0,s.jsx)("button",{onClick:()=>{G(null),S(null),N(""),y(""),g("")},className:"bg-gray-500 text-white px-2 py-1 rounded ml-2",children:"Cancel Edit"})]}),(0,s.jsx)("h2",{className:"text-xl font-semibold",children:"Chapters"}),(0,s.jsx)("ul",{children:m.map(e=>(0,s.jsxs)("li",{className:"mb-2",children:[(0,s.jsxs)("span",{className:"font-bold",children:[e.chapterNumber,". ",e.title]}),(0,s.jsxs)("div",{className:"flex gap-2 mt-1",children:[(0,s.jsx)("button",{onClick:()=>{N(e.title),y(e.content),g(e.chapterNumber.toString()),G(e.id),S(e)},className:"text-yellow-500",children:"Edit"}),(0,s.jsx)("button",{onClick:()=>I(e.id),className:"text-red-500",children:"Delete"})]})]},e.id))})]})}}},e=>{var a=a=>e(e.s=a);e.O(0,[992,163,645,441,684,358],()=>a(565)),_N_E=e.O()}]);