(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[522],{3166:(e,t,a)=>{"use strict";a.d(t,{A:()=>l});var s=a(2115),r=a(6203),n=a(6104);function l(){let[e,t]=(0,s.useState)(null);return(0,s.useEffect)(()=>{let e=(0,r.onAuthStateChanged)(n.j2,e=>{t(e)});return()=>e()},[]),{user:e}}},5695:(e,t,a)=>{"use strict";var s=a(8999);a.o(s,"useParams")&&a.d(t,{useParams:function(){return s.useParams}}),a.o(s,"useRouter")&&a.d(t,{useRouter:function(){return s.useRouter}})},6104:(e,t,a)=>{"use strict";a.d(t,{CS:()=>u,Gq:()=>o,HS:()=>x,J_:()=>h,Mv:()=>m,Vb:()=>b,YX:()=>y,ab:()=>p,db:()=>d,fC:()=>g,iJ:()=>i,j2:()=>c,qY:()=>v});var s=a(3915),r=a(5317),n=a(6203);let l=(0,s.Wp)({apiKey:"AIzaSyBreQy9u91K6FMTcoY4rl22zNAw_f0juAo",authDomain:"novelplane.firebaseapp.com",projectId:"novelplane",storageBucket:"novelplane.firebasestorage.app",messagingSenderId:"208383799577",appId:"1:208383799577:web:ca27cea78d7588d73e9588"}),d=(0,r.aU)(l),c=(0,n.getAuth)(l);async function i(e,t,a,s){let n=(0,r.H9)(d,"users/".concat(e,"/history"),"".concat(t,"_").concat(a));await (0,r.BN)(n,{novelId:t,chapterId:a,title:s,readAt:(0,r.O5)()})}let o=async(e,t,a)=>{let s=(0,r.H9)(d,"users/".concat(e,"/lastRead"),t);await (0,r.BN)(s,{chapterId:a})},u=async(e,t)=>{let a=(0,r.H9)(d,"users/".concat(e,"/lastRead"),t),s=await (0,r.x7)(a);return s.exists()&&s.data().chapterId||null},p=async()=>(await (0,r.GG)((0,r.rJ)(d,"novels"))).docs.map(e=>({id:e.id,...e.data()})),h=async e=>{let t=(await (0,r.GG)((0,r.rJ)(d,"bookmarks"))).docs.map(e=>({id:e.id,...e.data()})).filter(t=>t.userId===e&&t.novelId).map(e=>e.novelId);return 0===t.length?[]:(await (0,r.GG)((0,r.rJ)(d,"novels"))).docs.map(e=>({id:e.id,...e.data()})).filter(e=>t.includes(e.id))},x=async()=>{let e=await (0,r.GG)((0,r.rJ)(d,"novels")),t=new Set;return e.docs.forEach(e=>{let a=e.data();Array.isArray(a.tags)&&a.tags.forEach(e=>t.add(e))}),Array.from(t)},m=async e=>(await (0,r.GG)((0,r.rJ)(d,"novels"))).docs.map(e=>({id:e.id,...e.data()})).filter(t=>Array.isArray(t.tags)&&t.tags.includes(e)),g=async e=>{(0,r.H9)(d,"novels",e);let t=await (0,r.GG)((0,r.rJ)(d,"novels")),a=null;if(t.forEach(t=>{t.id===e&&(a={id:t.id,...t.data()})}),!a)return null;let s=(await (0,r.GG)((0,r.rJ)(d,"novels",e,"chapters"))).docs.map(e=>({id:e.id,...e.data()}));return{...a,chapters:s}},y=async(e,t)=>{(0,r.H9)(d,"novels",e,"chapters",t);let a=await (0,r.GG)((0,r.rJ)(d,"novels",e,"chapters")),s=null;return a.forEach(e=>{e.id===t&&(s={id:e.id,...e.data()})}),s},b=async e=>{let t=(0,r.rJ)(d,"novels",e,"chapters");return(await (0,r.GG)(t)).docs.map(e=>({id:e.id,...e.data()}))},v=async e=>(await (0,r.GG)((0,r.rJ)(d,"users/".concat(e,"/history")))).docs.map(e=>({id:e.id,...e.data()}))},6683:(e,t,a)=>{Promise.resolve().then(a.bind(a,9404))},9404:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>c});var s=a(5155),r=a(5695),n=a(2115),l=a(6104),d=a(3166);function c(){var e;let{id:t,chapterId:a}=(0,r.useParams)(),c=(0,r.useRouter)(),{user:i}=(0,d.A)(),[o,u]=(0,n.useState)(null),[p,h]=(0,n.useState)([]),[x,m]=(0,n.useState)(!0);(0,n.useEffect)(()=>{"string"==typeof t&&"string"==typeof a&&((0,l.YX)(t,a).then(e=>{u(e),i&&e&&((0,l.Gq)(i.uid,t,a),(0,l.iJ)(i.uid,t,a,e.title||"Chapter"))}),(0,l.Vb)(t).then(e=>{h(e),m(!1)}))},[t,a,i]);let g=p.findIndex(e=>e.id===a),y=g>0?p[g-1]:null,b=g<p.length-1?p[g+1]:null;return x?(0,s.jsx)("p",{className:"p-4 sm:p-6 text-center text-sm",children:"Loading chapter..."}):o?(0,s.jsxs)("div",{className:"max-w-2xl w-full mx-auto p-3 sm:p-6",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,s.jsx)("h1",{className:"text-xl sm:text-2xl font-bold text-blue-700 dark:text-blue-400",children:o.title}),(0,s.jsxs)("span",{className:"text-xs sm:text-sm text-gray-500 dark:text-gray-400",children:["Chapter ",g+1," of ",p.length]})]}),(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("label",{htmlFor:"chapter-select",className:"block text-xs sm:text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Jump to Chapter:"}),(0,s.jsx)("select",{id:"chapter-select",value:a,onChange:e=>c.push("/novels/".concat(t,"/chapters/").concat(e.target.value)),className:"w-full p-2 rounded border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-xs sm:text-sm dark:text-white",children:p.map(e=>(0,s.jsx)("option",{value:e.id,children:e.title||"Chapter ".concat(p.indexOf(e)+1)},e.id))})]}),(0,s.jsx)("article",{className:"prose dark:prose-invert max-w-none text-base sm:text-lg leading-relaxed text-gray-800 dark:text-gray-100",children:null==(e=o.content)?void 0:e.split("\n").map((e,t)=>(0,s.jsx)("p",{className:"mb-4",children:e},t))}),(0,s.jsxs)("div",{className:"flex justify-between items-center mt-10 border-t pt-6",children:[y?(0,s.jsxs)("button",{className:"px-4 py-2 bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 text-blue-600 dark:text-blue-400 rounded shadow",onClick:()=>c.push("/novels/".concat(t,"/chapters/").concat(y.id)),children:["← ",y.title]}):(0,s.jsx)("div",{}),b?(0,s.jsxs)("button",{className:"px-4 py-2 bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 text-blue-600 dark:text-blue-400 rounded shadow",onClick:()=>c.push("/novels/".concat(t,"/chapters/").concat(b.id)),children:[b.title," →"]}):(0,s.jsx)("div",{})]})]}):(0,s.jsx)("p",{className:"p-4 sm:p-6 text-center text-red-500 text-sm",children:"Chapter not found."})}}},e=>{var t=t=>e(e.s=t);e.O(0,[992,163,645,441,684,358],()=>t(6683)),_N_E=e.O()}]);