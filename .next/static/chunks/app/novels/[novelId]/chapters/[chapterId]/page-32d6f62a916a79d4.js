(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[522],{3166:(e,a,t)=>{"use strict";t.d(a,{A:()=>d});var r=t(2115),s=t(6203),n=t(6104);function d(){let[e,a]=(0,r.useState)(null);return(0,r.useEffect)(()=>{let e=(0,s.onAuthStateChanged)(n.j2,e=>{a(e)});return()=>e()},[]),{user:e}}},5695:(e,a,t)=>{"use strict";var r=t(8999);t.o(r,"useParams")&&t.d(a,{useParams:function(){return r.useParams}}),t.o(r,"useRouter")&&t.d(a,{useRouter:function(){return r.useRouter}})},6104:(e,a,t)=>{"use strict";t.d(a,{CS:()=>u,Gq:()=>o,HS:()=>x,J_:()=>p,Mv:()=>m,Vb:()=>b,YX:()=>y,ab:()=>h,db:()=>l,fC:()=>g,iJ:()=>i,j2:()=>c,qY:()=>v});var r=t(3915),s=t(5317),n=t(6203);let d=(0,r.Wp)({apiKey:"AIzaSyBreQy9u91K6FMTcoY4rl22zNAw_f0juAo",authDomain:"novelplane.firebaseapp.com",projectId:"novelplane",storageBucket:"novelplane.firebasestorage.app",messagingSenderId:"208383799577",appId:"1:208383799577:web:ca27cea78d7588d73e9588"}),l=(0,s.aU)(d),c=(0,n.getAuth)(d);async function i(e,a,t,r){let n=(0,s.H9)(l,"users/".concat(e,"/history"),"".concat(a,"_").concat(t));await (0,s.BN)(n,{novelId:a,chapterId:t,title:r,readAt:(0,s.O5)()})}let o=async(e,a,t)=>{let r=(0,s.H9)(l,"users/".concat(e,"/lastRead"),a);await (0,s.BN)(r,{chapterId:t})},u=async(e,a)=>{let t=(0,s.H9)(l,"users/".concat(e,"/lastRead"),a),r=await (0,s.x7)(t);return r.exists()&&r.data().chapterId||null},h=async()=>(await (0,s.GG)((0,s.rJ)(l,"novels"))).docs.map(e=>({id:e.id,...e.data()})),p=async e=>{let a=(await (0,s.GG)((0,s.rJ)(l,"bookmarks"))).docs.map(e=>({id:e.id,...e.data()})).filter(a=>a.userId===e&&a.novelId).map(e=>e.novelId);return 0===a.length?[]:(await (0,s.GG)((0,s.rJ)(l,"novels"))).docs.map(e=>({id:e.id,...e.data()})).filter(e=>a.includes(e.id))},x=async()=>{let e=await (0,s.GG)((0,s.rJ)(l,"novels")),a=new Set;return e.docs.forEach(e=>{let t=e.data();Array.isArray(t.tags)&&t.tags.forEach(e=>a.add(e))}),Array.from(a)},m=async e=>(await (0,s.GG)((0,s.rJ)(l,"novels"))).docs.map(e=>({id:e.id,...e.data()})).filter(a=>Array.isArray(a.tags)&&a.tags.includes(e)),g=async e=>{(0,s.H9)(l,"novels",e);let a=await (0,s.GG)((0,s.rJ)(l,"novels")),t=null;if(a.forEach(a=>{a.id===e&&(t={id:a.id,...a.data()})}),!t)return null;let r=(await (0,s.GG)((0,s.rJ)(l,"novels",e,"chapters"))).docs.map(e=>({id:e.id,...e.data()}));return{...t,chapters:r}},y=async(e,a)=>{(0,s.H9)(l,"novels",e,"chapters",a);let t=await (0,s.GG)((0,s.rJ)(l,"novels",e,"chapters")),r=null;return t.forEach(e=>{e.id===a&&(r={id:e.id,...e.data()})}),r},b=async e=>{let a=(0,s.rJ)(l,"novels",e,"chapters");return(await (0,s.GG)(a)).docs.map(e=>({id:e.id,...e.data()}))},v=async e=>(await (0,s.GG)((0,s.rJ)(l,"users/".concat(e,"/history")))).docs.map(e=>({id:e.id,...e.data()}))},6683:(e,a,t)=>{Promise.resolve().then(t.bind(t,9404))},9404:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>c});var r=t(5155),s=t(5695),n=t(2115),d=t(6104),l=t(3166);function c(){var e;let{id:a,chapterId:t}=(0,s.useParams)(),c=(0,s.useRouter)(),{user:i}=(0,l.A)(),[o,u]=(0,n.useState)(null),[h,p]=(0,n.useState)([]),[x,m]=(0,n.useState)(!0);(0,n.useEffect)(()=>{"string"==typeof a&&"string"==typeof t&&((0,d.YX)(a,t).then(e=>{u(e),i&&e&&((0,d.Gq)(i.uid,a,t),(0,d.iJ)(i.uid,a,t,e.title||"Chapter"))}),(0,d.Vb)(a).then(e=>{p(e),m(!1)}))},[a,t,i]);let g=h.findIndex(e=>e.id===t),y=g>0?h[g-1]:null,b=g<h.length-1?h[g+1]:null;return x?(0,r.jsx)("p",{className:"p-6 text-center",children:"Loading chapter..."}):o?(0,r.jsxs)("div",{className:"max-w-3xl mx-auto px-4 py-8 bg-white dark:bg-gray-900 rounded-lg shadow-md",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-blue-700 dark:text-blue-400",children:o.title}),(0,r.jsxs)("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Chapter ",g+1," of ",h.length]})]}),(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)("label",{htmlFor:"chapter-select",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Jump to Chapter:"}),(0,r.jsx)("select",{id:"chapter-select",value:t,onChange:e=>c.push("/novels/".concat(a,"/chapters/").concat(e.target.value)),className:"w-full p-2 rounded border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-sm dark:text-white",children:h.map(e=>(0,r.jsx)("option",{value:e.id,children:e.title||"Chapter ".concat(h.indexOf(e)+1)},e.id))})]}),(0,r.jsx)("article",{className:"prose dark:prose-invert max-w-none text-lg leading-relaxed text-gray-800 dark:text-gray-100",children:null==(e=o.content)?void 0:e.split("\n").map((e,a)=>(0,r.jsx)("p",{className:"mb-4",children:e},a))}),(0,r.jsxs)("div",{className:"flex justify-between items-center mt-10 border-t pt-6",children:[y?(0,r.jsxs)("button",{className:"px-4 py-2 bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 text-blue-600 dark:text-blue-400 rounded shadow",onClick:()=>c.push("/novels/".concat(a,"/chapters/").concat(y.id)),children:["← ",y.title]}):(0,r.jsx)("div",{}),b?(0,r.jsxs)("button",{className:"px-4 py-2 bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 text-blue-600 dark:text-blue-400 rounded shadow",onClick:()=>c.push("/novels/".concat(a,"/chapters/").concat(b.id)),children:[b.title," →"]}):(0,r.jsx)("div",{})]})]}):(0,r.jsx)("p",{className:"p-6 text-center text-red-500",children:"Chapter not found."})}}},e=>{var a=a=>e(e.s=a);e.O(0,[992,163,645,441,684,358],()=>a(6683)),_N_E=e.O()}]);