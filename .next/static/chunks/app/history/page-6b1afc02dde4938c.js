(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[429],{2900:(e,a,t)=>{Promise.resolve().then(t.bind(t,7643))},3166:(e,a,t)=>{"use strict";t.d(a,{A:()=>d});var s=t(2115),l=t(6203),r=t(6104);function d(){let[e,a]=(0,s.useState)(null);return(0,s.useEffect)(()=>{let e=(0,l.onAuthStateChanged)(r.j2,e=>{a(e)});return()=>e()},[]),{user:e}}},6104:(e,a,t)=>{"use strict";t.d(a,{CS:()=>u,Gq:()=>o,HS:()=>p,J_:()=>h,Mv:()=>m,Vb:()=>x,YX:()=>y,ab:()=>v,db:()=>n,fC:()=>f,iJ:()=>c,j2:()=>i,qY:()=>g});var s=t(3915),l=t(5317),r=t(6203);let d=(0,s.Wp)({apiKey:"AIzaSyBreQy9u91K6FMTcoY4rl22zNAw_f0juAo",authDomain:"novelplane.firebaseapp.com",projectId:"novelplane",storageBucket:"novelplane.firebasestorage.app",messagingSenderId:"208383799577",appId:"1:208383799577:web:ca27cea78d7588d73e9588"}),n=(0,l.aU)(d),i=(0,r.getAuth)(d);async function c(e,a,t,s){let r=(0,l.H9)(n,"users/".concat(e,"/history"),"".concat(a,"_").concat(t));await (0,l.BN)(r,{novelId:a,chapterId:t,title:s,readAt:(0,l.O5)()})}let o=async(e,a,t)=>{let s=(0,l.H9)(n,"users/".concat(e,"/lastRead"),a);await (0,l.BN)(s,{chapterId:t})},u=async(e,a)=>{let t=(0,l.H9)(n,"users/".concat(e,"/lastRead"),a),s=await (0,l.x7)(t);return s.exists()&&s.data().chapterId||null},v=async()=>(await (0,l.GG)((0,l.rJ)(n,"novels"))).docs.map(e=>({id:e.id,...e.data()})),h=async e=>{let a=(await (0,l.GG)((0,l.rJ)(n,"bookmarks"))).docs.map(e=>({id:e.id,...e.data()})).filter(a=>a.userId===e&&a.novelId).map(e=>e.novelId);return 0===a.length?[]:(await (0,l.GG)((0,l.rJ)(n,"novels"))).docs.map(e=>({id:e.id,...e.data()})).filter(e=>a.includes(e.id))},p=async()=>{let e=await (0,l.GG)((0,l.rJ)(n,"novels")),a=new Set;return e.docs.forEach(e=>{let t=e.data();Array.isArray(t.tags)&&t.tags.forEach(e=>a.add(e))}),Array.from(a)},m=async e=>(await (0,l.GG)((0,l.rJ)(n,"novels"))).docs.map(e=>({id:e.id,...e.data()})).filter(a=>Array.isArray(a.tags)&&a.tags.includes(e)),f=async e=>{(0,l.H9)(n,"novels",e);let a=await (0,l.GG)((0,l.rJ)(n,"novels")),t=null;if(a.forEach(a=>{a.id===e&&(t={id:a.id,...a.data()})}),!t)return null;let s=(await (0,l.GG)((0,l.rJ)(n,"novels",e,"chapters"))).docs.map(e=>({id:e.id,...e.data()}));return{...t,chapters:s}},y=async(e,a)=>{(0,l.H9)(n,"novels",e,"chapters",a);let t=await (0,l.GG)((0,l.rJ)(n,"novels",e,"chapters")),s=null;return t.forEach(e=>{e.id===a&&(s={id:e.id,...e.data()})}),s},x=async e=>{let a=(0,l.rJ)(n,"novels",e,"chapters");return(await (0,l.GG)(a)).docs.map(e=>({id:e.id,...e.data()}))},g=async e=>(await (0,l.GG)((0,l.rJ)(n,"users/".concat(e,"/history")))).docs.map(e=>({id:e.id,...e.data()}))},7643:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>n});var s=t(5155),l=t(2115),r=t(3166),d=t(6104);function n(){let{user:e}=(0,r.A)(),[a,t]=(0,l.useState)([]),[n,i]=(0,l.useState)({});(0,l.useEffect)(()=>{(async()=>{if(e){let s=await (0,d.qY)(e.uid),l={};for(let e of s){var a;if(!l[e.novelId]){let a=await (0,d.fC)(e.novelId);l[e.novelId]={novelId:e.novelId,novelTitle:(null==a?void 0:a.title)||e.novelId,cover:null==a?void 0:a.cover,chapters:[],lastReadAt:0}}l[e.novelId].chapters.push(e);let t=(null==(a=e.readAt)?void 0:a.toDate().getTime())||0;t>(l[e.novelId].lastReadAt||0)&&(l[e.novelId].lastReadAt=t)}t(Object.values(l).sort((e,a)=>(a.lastReadAt||0)-(e.lastReadAt||0)))}})()},[e]);let c=e=>{i(a=>({...a,[e]:!a[e]}))};return(0,s.jsxs)("div",{className:"max-w-4xl mx-auto px-4 py-8",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"\uD83D\uDCD6 Reading History"}),0===a.length?(0,s.jsx)("p",{className:"text-gray-500",children:"No chapters read yet."}):a.map(e=>{let{novelId:a,novelTitle:t,cover:l,chapters:r}=e;return(0,s.jsxs)("div",{className:"mb-6 bg-white dark:bg-gray-900 p-4 rounded-lg shadow",children:[(0,s.jsxs)("button",{onClick:()=>c(a),className:"w-full flex items-center justify-between text-left",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[l&&(0,s.jsx)("img",{src:l,alt:t,className:"w-12 h-18 object-cover rounded"}),(0,s.jsxs)("h2",{className:"text-lg font-semibold text-blue-700 dark:text-blue-300",children:["\uD83D\uDCD8 ",t]})]}),(0,s.jsx)("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:n[a]?"▲ Hide":"▼ Show"})]}),n[a]&&(0,s.jsx)("ul",{className:"mt-4 divide-y",children:r.sort((e,a)=>{var t,s;return((null==(t=a.readAt)?void 0:t.toDate().getTime())||0)-((null==(s=e.readAt)?void 0:s.toDate().getTime())||0)}).map((e,a)=>{var t;return(0,s.jsx)("li",{className:"py-2",children:(0,s.jsxs)("a",{href:"/novels/".concat(e.novelId,"/chapters/").concat(e.chapterId),className:"text-blue-600 hover:underline",children:[e.title," (Read on ",null==(t=e.readAt)?void 0:t.toDate().toLocaleString(),")"]})},a)})})]},a)})]})}}},e=>{var a=a=>e(e.s=a);e.O(0,[992,163,645,441,684,358],()=>a(2900)),_N_E=e.O()}]);